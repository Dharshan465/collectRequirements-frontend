<div class="page-root">
    <header class="topbar">
        <div class="brand">Collect Requirements</div>
        <div class="user">User</div>
    </header>

    <main class="content">
        <div *ngIf="loading" class="loading">Loading event details...</div>
        <div *ngIf="error" class="error">{{ error }}</div>

        <section class="card" *ngIf="event && !loading">
            <h2 class="card-title">Edit Event Details</h2>
            <div class="event-grid">
                <div class="grid-row">
                    <div class="label-pill">Event Name</div>
                    <input class="value-box" [(ngModel)]="event.eventName" />
                </div>

                <div class="grid-row">
                    <div class="label-pill">Description</div>
                    <textarea class="value-box description" [(ngModel)]="event.description"></textarea>
                </div>

                <div class="grid-row">
                    <div class="label-pill">Participants</div>
                    <input class="value-box" type="number" [(ngModel)]="event.participantsCount" />
                </div>

                <div class="grid-row">
                    <div class="label-pill">Duration</div>
                    <input class="value-box" [(ngModel)]="event.duration" />
                </div>

                <div class="grid-row">
                    <div class="label-pill">Event Type</div>
                    <input class="value-box" [(ngModel)]="event.eventType" />
                </div>

                <div class="grid-row">
                    <div class="label-pill">Funding Source</div>
                    <input class="value-box" [(ngModel)]="event.fundingSource" />
                </div>
            </div>

            <div class="button-container">
                <button class="save-button" (click)="saveEvent()">Save Changes</button>
            </div>
        </section>

        <section class="card requests" *ngIf="!loading">
            <h3 class="card-title">Related Requests</h3>

            <div *ngIf="requests.length === 0" class="empty">No requests found for this event.</div>

            <div class="table-wrap" *ngIf="requests.length > 0">
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>Req ID</th>
                            <th>Requestor</th>
                            <th>Department</th>
                            <th>Request Date</th>
                            <th>Status</th>
                            <th>Group</th>
                            <th>Justification</th>
                            <th>Associates</th>
                            <th>TAN</th>
                            <th>Curriculum</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let r of requests">
                            <td>{{r.requestId }}</td>
                            <td>{{r.requestorId || '-' }}</td>
                            <td>{{ r.departmentName || r.departmentId || '-' }}</td>
                            <td>{{ r.requestDate | date:'medium' }}</td>
                            <td>{{ r.requestStatus }}</td>
                            <td>{{ r.groupRequest ? 'Yes' : 'No' }}</td>
                            <td class="nowrap">{{ r.justification }}</td>
                            <td class="center">{{ r.noOfAssociates ?? '-' }}</td>
                            <td>{{ r.tanNumber }}</td>
                            <td>{{ r.curriculumLink || '-' }}</td>
                            <td>
                                <button 
                                    class="remove-button" 
                                    (click)="removeRequest(r.requestId)"
                                    [disabled]="isRemovingRequest(r.requestId)">
                                    {{ isRemovingRequest(r.requestId) ? 'Removing...' : 'Remove' }}
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="button-container">
                <button class="add-request-button" (click)="addRequest()">Add Request</button>
            </div>
        </section>
    </main>

    <footer class="page-footer">Footer</footer>
</div>
